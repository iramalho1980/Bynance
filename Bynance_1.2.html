<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Financeiro</title>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Ubuntu', sans-serif;
            /* Gradiente padr√£o - ser√° alterado pelo JS */
            background: linear-gradient(135deg, #4a7c9e 0%, #7ba88a 35%, #b5c57a 65%, #f0d86a 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
            transition: background 0.5s ease;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: white;
            font-size: 2.5rem;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .summary-card {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        .summary-card h3 {
            color: white;
            font-size: 1.1rem;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .summary-card .value {
            color: white;
            font-size: 2rem;
            font-weight: 700;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }

        .input-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .collapsible-header {
            background: rgba(255, 255, 255, 0.3);
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            transition: all 0.3s;
        }

        .collapsible-header:hover {
            background: rgba(255, 255, 255, 0.4);
        }

        .collapsible-header h3 {
            color: white;
            font-size: 1.3rem;
        }

        .collapsible-header .arrow {
            color: white;
            font-size: 1.5rem;
            transition: transform 0.3s;
        }

        .collapsible-header.active .arrow {
            transform: rotate(180deg);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .collapsible-content.active {
            max-height: 500px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            color: white;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.9);
            font-family: 'Ubuntu', sans-serif;
            font-size: 1rem;
        }

        .btn {
            padding: 12px 25px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-family: 'Ubuntu', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .btn-primary {
            background: rgba(74, 124, 158, 0.9);
            color: white;
        }

        .btn-primary:hover {
            background: rgba(74, 124, 158, 1);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .btn-success {
            background: rgba(123, 168, 138, 0.9);
            color: white;
        }

        .btn-success:hover {
            background: rgba(123, 168, 138, 1);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: rgba(220, 53, 69, 0.9);
            color: white;
            padding: 5px 10px;
            font-size: 0.9rem;
        }

        .btn-danger:hover {
            background: rgba(220, 53, 69, 1);
        }

        .btn-warning {
            background: rgba(255, 193, 7, 0.9);
            color: #333;
            padding: 5px 10px;
            font-size: 0.9rem;
        }

        .btn-warning:hover {
            background: rgba(255, 193, 7, 1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        table th {
            background: rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        table td {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        table tr:hover td {
            background: rgba(255, 255, 255, 0.2);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-container {
            position: relative;
            height: 350px;
        }

        .actions-section {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px; /* Espa√ßamento entre os bot√µes */
            margin-top: 30px;
        }

        .file-input-wrapper {
            display: inline-block;
            position: relative;
            overflow: hidden;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        /* Novo CSS para o seletor de skin */
        .skin-selector {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .skin-icon {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 24px;
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
        }

        .skin-icon:hover {
            background: rgba(255, 255, 255, 0.5);
            transform: scale(1.05);
        }

        .skin-options {
            position: absolute;
            top: 60px;
            right: 0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            display: none;
            flex-direction: column;
        }

        .skin-options.active {
            display: flex;
        }

        .skin-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin: 5px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: border 0.2s;
        }

        .skin-option:hover {
            border: 3px solid #333;
        }

        .skin-option.selected {
            border: 3px solid #4a7c9e; /* Cor de destaque */
        }

        /* Novo CSS para a tabela de itens realizados */
        .realizados-card {
            opacity: 0.7;
        }

        .realizados-card table td {
            text-decoration: line-through;
        }

        @media (max-width: 768px) {
            .input-section,
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.8rem;
            }

            body {
                padding: 15px;
            }

            .summary-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .glass-card {
                padding: 15px;
                margin-bottom: 15px;
            }

            .summary-card {
                padding: 15px;
            }

            .summary-card .value {
                font-size: 1.5rem;
            }

            .actions-section {
                flex-direction: column;
                gap: 10px;
            }

            .btn {
                width: 100%;
                margin-right: 0;
                margin-bottom: 10px;
            }

            table {
                font-size: 0.85rem;
            }

            table th,
            table td {
                padding: 8px;
            }

            .skin-selector {
                top: 10px;
                right: 10px;
            }

            .skin-icon {
                width: 45px;
                height: 45px;
                font-size: 20px;
            }

            .skin-options {
                top: 55px;
                right: 0;
            }

            .skin-option {
                width: 35px;
                height: 35px;
                margin: 4px;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.5rem;
                margin-bottom: 20px;
            }

            body {
                padding: 10px;
            }

            .container {
                max-width: 100%;
            }

            .summary-card h3 {
                font-size: 0.95rem;
            }

            .summary-card .value {
                font-size: 1.3rem;
            }

            .glass-card {
                padding: 12px;
                border-radius: 12px;
            }

            .collapsible-header {
                padding: 12px;
                margin-bottom: 8px;
            }

            .collapsible-header h3 {
                font-size: 1.1rem;
            }

            .form-group input,
            .form-group select {
                padding: 8px;
                font-size: 16px;
            }

            .btn {
                padding: 10px 15px;
                font-size: 0.9rem;
            }

            .btn-danger,
            .btn-warning {
                padding: 4px 8px;
                font-size: 0.8rem;
            }

            .chart-container {
                height: 250px;
            }

            table {
                font-size: 0.75rem;
            }

            table th,
            table td {
                padding: 6px;
            }

            .skin-icon {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }

            .skin-option {
                width: 30px;
                height: 30px;
                margin: 3px;
            }
        }
    </style>
</head>
<body>
    <div class="skin-selector">
        <div class="skin-icon" onclick="toggleSkinOptions()">üé®</div>
        <div class="skin-options" id="skinOptions">
            <!-- Op√ß√µes de skin ser√£o geradas pelo JS -->
        </div>
    </div>

    <div class="container">
        <h1>üè¶ Sistema de Controle Financeiro</h1>

        <!-- Resumo -->
        <div class="summary-grid">
            <div class="summary-card">
                <h3>Receita Total</h3>
                <div class="value" id="totalReceita">R$ 0,00</div>
            </div>
            <div class="summary-card">
                <h3>Despesa Total</h3>
                <div class="value" id="totalDespesa">R$ 0,00</div>
            </div>
            <div class="summary-card">
                <h3>Saldo</h3>
                <div class="value" id="saldo">R$ 0,00</div>
            </div>
        </div>

        <!-- Formul√°rios de Entrada -->
        <div class="input-section">
            <!-- Nova Receita -->
            <div class="glass-card">
                <div class="collapsible-header" onclick="toggleCollapse('receita')">
                    <h3>‚ûï Nova Receita</h3>
                    <span class="arrow">‚ñº</span>
                </div>
                <div class="collapsible-content" id="receita-content">
                    <form id="formReceita" onsubmit="adicionarReceita(event)">
                        <div class="form-group">
                            <label>Descri√ß√£o</label>
                            <input type="text" id="receitaDescricao" required>
                        </div>
                        <div class="form-group">
                            <label>Categoria</label>
                            <select id="receitaCategoria" required>
                                <option value="">Selecione...</option>
                                <option value="Sal√°rio">Sal√°rio</option>
                                <option value="Freelance">Freelance</option>
                                <option value="Investimentos">Investimentos</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Valor (R$)</label>
                            <input type="number" id="receitaValor" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label>Data</label>
                            <input type="date" id="receitaData" required>
                        </div>
                        <button type="submit" class="btn btn-success">Adicionar Receita</button>
                    </form>
                </div>
            </div>

            <!-- Nova Despesa -->
            <div class="glass-card">
                <div class="collapsible-header" onclick="toggleCollapse('despesa')">
                    <h3>‚ûñ Nova Despesa</h3>
                    <span class="arrow">‚ñº</span>
                </div>
                <div class="collapsible-content" id="despesa-content">
                    <form id="formDespesa" onsubmit="adicionarDespesa(event)">
                        <div class="form-group">
                            <label>Descri√ß√£o</label>
                            <input type="text" id="despesaDescricao" required>
                        </div>
                        <div class="form-group">
                            <label>Categoria</label>
                            <select id="despesaCategoria" required>
                                <option value="">Selecione...</option>
                                <option value="Alimenta√ß√£o">Alimenta√ß√£o</option>
                                <option value="Transporte">Transporte</option>
                                <option value="Moradia">Moradia</option>
                                <option value="Sa√∫de">Sa√∫de</option>
                                <option value="Educa√ß√£o">Educa√ß√£o</option>
                                <option value="Lazer">Lazer</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Valor (R$)</label>
                            <input type="number" id="despesaValor" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label>Data</label>
                            <input type="date" id="despesaData" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Adicionar Despesa</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Itens Inseridos (Pendentes) -->
        <div class="glass-card">
            <h3 style="color: white; margin-bottom: 15px;">üìã Itens Inseridos (Pendentes)</h3>
            <table id="tabelaItens">
                <thead>
                    <tr>
                        <th>Realizado</th>
                        <th>Tipo</th>
                        <th>Data</th>
                        <th>Descri√ß√£o</th>
                        <th>Categoria</th>
                        <th>Valor</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="tabelaItensBody">
                    <tr>
                        <td colspan="7" style="text-align: center;">Nenhum item pendente</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Itens Realizados -->
        <div class="glass-card realizados-card">
            <h3 style="color: white; margin-bottom: 15px;">‚úÖ Itens Realizados</h3>
            <table id="tabelaItensRealizados">
                <thead>
                    <tr>
                        <th>Realizado</th>
                        <th>Tipo</th>
                        <th>Data</th>
                        <th>Descri√ß√£o</th>
                        <th>Categoria</th>
                        <th>Valor</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="tabelaItensRealizadosBody">
                    <tr>
                        <td colspan="7" style="text-align: center;">Nenhum item realizado</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Dashboards -->
        <div class="dashboard-grid">
            <div class="glass-card">
                <h3 style="color: white; margin-bottom: 15px;">üìä Dashboard de Receitas</h3>
                <div class="chart-container">
                    <canvas id="chartReceitas"></canvas>
                </div>
            </div>
            <div class="glass-card">
                <h3 style="color: white; margin-bottom: 15px;">üìä Dashboard de Despesas</h3>
                <div class="chart-container">
                    <canvas id="chartDespesas"></canvas>
                </div>
            </div>
        </div>

        <!-- Dashboard Comparativo -->
        <div class="glass-card">
            <h3 style="color: white; margin-bottom: 15px;">üìà Receitas vs Despesas</h3>
            <div class="chart-container" style="height: 400px;">
                <canvas id="chartComparativo"></canvas>
            </div>
        </div>

        <!-- Bot√µes de A√ß√£o -->
        <div class="actions-section">
            <button class="btn btn-success" onclick="salvarJSON()">üíæ Salvar Dados (JSON)</button>
            <div class="file-input-wrapper">
                <button class="btn btn-primary">üìÇ Carregar Dados (JSON)</button>
                <input type="file" id="fileInput" accept=".json" onchange="carregarJSON(event)">
            </div>
            <button class="btn btn-primary" onclick="gerarRelatorioPDF()">üìÑ Gerar Relat√≥rio (PDF)</button>
        </div>
    </div>

    <script>
        // Dados
        let receitas = [];
        let despesas = [];
        let editandoIndex = null;
        let editandoTipo = null;

        // Charts
        let chartReceitas, chartDespesas, chartComparativo;

        // Paletas de cores (Cores baseadas na imagem de refer√™ncia: Azul, Verde-√Ågua, Laranja)
        const coresGrafico = [
            '#4A90E2', // Azul
            '#6EE7B7', // Verde-√Ågua
            '#F5A623', // Laranja
            '#34495E', // Azul Escuro (para mais categorias)
            '#9B59B6', // Roxo (para mais categorias)
        ];
        const coresReceitas = coresGrafico;
        const coresDespesas = coresGrafico;

        // Op√ß√µes de Skin
        const skins = [
            {
                name: "Padr√£o (Dourado/Verde)",
                css: "linear-gradient(135deg, #4a7c9e 0%, #7ba88a 35%, #b5c57a 65%, #f0d86a 100%)"
            },
            {
                name: "Azul Sereno",
                css: "linear-gradient(to right, #A7BFE8, #6190E8)"
            },
            {
                name: "Verde Floresta",
                css: "linear-gradient(to right, #99f2c8, #1f4037)"
            },
            {
                name: "Ciano Noturno",
                css: "linear-gradient(to right, #0f3443, #34e89e)"
            },
            {
                name: "Rosa Escuro",
                css: "linear-gradient(to right, #BE5869, #403A3E)"
            },
            {
                name: "Azul Profundo",
                css: "linear-gradient(to right, #2C5364, #203A43, #0F2027)"
            },
            {
                name: "Azul Escuro",
                css: "linear-gradient(to right, #3A6073, #16222A)"
            },
            {
                name: "Amarelo Oceano",
                css: "linear-gradient(to right, #FFE47A, #3D7EAA)"
            },
            {
                name: "Cinza Met√°lico",
                css: "linear-gradient(to right, #414345, #232526)"
            }
        ];
        let skinAtual = skins[0].css;

        // Inicializar data de hoje e skins
        document.addEventListener('DOMContentLoaded', function() {
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('receitaData').value = hoje;
            document.getElementById('despesaData').value = hoje;
            inicializarCharts();
            inicializarSkins();
        });

        // L√≥gica do Seletor de Skin
        function inicializarSkins() {
            const skinOptionsDiv = document.getElementById('skinOptions');
            skins.forEach((skin, index) => {
                const option = document.createElement('div');
                option.className = 'skin-option';
                option.style.background = skin.css;
                option.title = skin.name;
                option.onclick = () => mudarSkin(skin.css, index);
                skinOptionsDiv.appendChild(option);
            });
            // Aplica o skin padr√£o e marca como selecionado
            mudarSkin(skins[0].css, 0);
        }

        function toggleSkinOptions() {
            document.getElementById('skinOptions').classList.toggle('active');
        }

        function mudarSkin(css, index) {
            document.body.style.background = css;
            skinAtual = css;
            
            // Atualiza a marca√ß√£o de sele√ß√£o
            document.querySelectorAll('.skin-option').forEach(opt => opt.classList.remove('selected'));
            document.getElementById('skinOptions').children[index].classList.add('selected');
        }

        // Toggle Collapse
        function toggleCollapse(tipo) {
            const content = document.getElementById(tipo + '-content');
            const header = content.previousElementSibling;
            
            content.classList.toggle('active');
            header.classList.toggle('active');
        }

        // Adicionar Receita
        function adicionarReceita(event) {
            event.preventDefault();
            
            const receita = {
                descricao: document.getElementById('receitaDescricao').value,
                categoria: document.getElementById('receitaCategoria').value,
                valor: parseFloat(document.getElementById('receitaValor').value),
                data: document.getElementById('receitaData').value,
                realizado: false // Novo campo
            };

            if (editandoIndex !== null && editandoTipo === 'receita') {
                receitas[editandoIndex] = {...receitas[editandoIndex], ...receita};
                editandoIndex = null;
                editandoTipo = null;
            } else {
                receitas.push(receita);
            }

            document.getElementById('formReceita').reset();
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('receitaData').value = hoje;
            
            atualizarInterface();
        }

        // Adicionar Despesa
        function adicionarDespesa(event) {
            event.preventDefault();
            
            const despesa = {
                descricao: document.getElementById('despesaDescricao').value,
                categoria: document.getElementById('despesaCategoria').value,
                valor: parseFloat(document.getElementById('despesaValor').value),
                data: document.getElementById('despesaData').value,
                realizado: false // Novo campo
            };

            if (editandoIndex !== null && editandoTipo === 'despesa') {
                despesas[editandoIndex] = {...despesas[editandoIndex], ...despesa};
                editandoIndex = null;
                editandoTipo = null;
            } else {
                despesas.push(despesa);
            }

            document.getElementById('formDespesa').reset();
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('despesaData').value = hoje;
            
            atualizarInterface();
        }

        // Marcar/Desmarcar como Realizado
        function marcarRealizado(tipo, index, isRealizado) {
            if (tipo === 'receita') {
                receitas[index].realizado = isRealizado;
            } else {
                despesas[index].realizado = isRealizado;
            }
            atualizarInterface();
        }

        // Editar Item
        function editarItem(tipo, index) {
            editandoIndex = index;
            editandoTipo = tipo;

            if (tipo === 'receita') {
                const item = receitas[index];
                document.getElementById('receitaDescricao').value = item.descricao;
                document.getElementById('receitaCategoria').value = item.categoria;
                document.getElementById('receitaValor').value = item.valor;
                document.getElementById('receitaData').value = item.data;
                
                // Abrir o collapse
                const content = document.getElementById('receita-content');
                const header = content.previousElementSibling;
                content.classList.add('active');
                header.classList.add('active');
            } else {
                const item = despesas[index];
                document.getElementById('despesaDescricao').value = item.descricao;
                document.getElementById('despesaCategoria').value = item.categoria;
                document.getElementById('despesaValor').value = item.valor;
                document.getElementById('despesaData').value = item.data;
                
                // Abrir o collapse
                const content = document.getElementById('despesa-content');
                const header = content.previousElementSibling;
                content.classList.add('active');
                header.classList.add('active');
            }
        }

        // Excluir Item
        function excluirItem(tipo, index) {
            if (confirm('Tem certeza que deseja excluir este item?')) {
                if (tipo === 'receita') {
                    receitas.splice(index, 1);
                } else {
                    despesas.splice(index, 1);
                }
                atualizarInterface();
            }
        }

        // Atualizar Interface
        function atualizarInterface() {
            atualizarResumo();
            atualizarTabela();
            atualizarCharts();
        }

        // Atualizar Resumo
        function atualizarResumo() {
            const totalReceita = receitas
                .filter(r => !r.realizado) // Apenas itens pendentes
                .reduce((sum, item) => sum + item.valor, 0);
            const totalDespesa = despesas
                .filter(d => !d.realizado) // Apenas itens pendentes
                .reduce((sum, item) => sum + item.valor, 0);
            const saldo = totalReceita - totalDespesa;

            document.getElementById('totalReceita').textContent = formatarMoeda(totalReceita);
            document.getElementById('totalDespesa').textContent = formatarMoeda(totalDespesa);
            document.getElementById('saldo').textContent = formatarMoeda(saldo);
            document.getElementById('saldo').style.color = saldo >= 0 ? '#90EE90' : '#FF6B6B';
        }

        // Atualizar Tabela
        function atualizarTabela() {
            const tbodyPendentes = document.getElementById('tabelaItensBody');
            const tbodyRealizados = document.getElementById('tabelaItensRealizadosBody');
            tbodyPendentes.innerHTML = '';
            tbodyRealizados.innerHTML = '';

            const itensPendentes = [
                ...receitas.map((item, index) => ({...item, tipo: 'receita', index})).filter(item => !item.realizado),
                ...despesas.map((item, index) => ({...item, tipo: 'despesa', index})).filter(item => !item.realizado)
            ].sort((a, b) => new Date(b.data) - new Date(a.data));

            const itensRealizados = [
                ...receitas.map((item, index) => ({...item, tipo: 'receita', index})).filter(item => item.realizado),
                ...despesas.map((item, index) => ({...item, tipo: 'despesa', index})).filter(item => item.realizado)
            ].sort((a, b) => new Date(b.data) - new Date(a.data));

            // Tabela Pendentes
            if (itensPendentes.length === 0) {
                tbodyPendentes.innerHTML = '<tr><td colspan="7" style="text-align: center;">Nenhum item pendente</td></tr>';
            } else {
                itensPendentes.forEach(item => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td><input type="checkbox" onchange="marcarRealizado('${item.tipo}', ${item.index}, this.checked)"></td>
                        <td>${item.tipo === 'receita' ? 'üü¢ Receita' : 'üî¥ Despesa'}</td>
                        <td>${formatarData(item.data)}</td>
                        <td>${item.descricao}</td>
                        <td>${item.categoria}</td>
                        <td style="font-weight: 600;">${formatarMoeda(item.valor)}</td>
                        <td>
                            <button class="btn btn-warning" onclick="editarItem('${item.tipo}', ${item.index})">‚úèÔ∏è Editar</button>
                            <button class="btn btn-danger" onclick="excluirItem('${item.tipo}', ${item.index})">üóëÔ∏è Excluir</button>
                        </td>
                    `;
                    tbodyPendentes.appendChild(tr);
                });
            }

            // Tabela Realizados
            if (itensRealizados.length === 0) {
                tbodyRealizados.innerHTML = '<tr><td colspan="7" style="text-align: center;">Nenhum item realizado</td></tr>';
            } else {
                itensRealizados.forEach(item => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td><input type="checkbox" checked onchange="marcarRealizado('${item.tipo}', ${item.index}, this.checked)"></td>
                        <td>${item.tipo === 'receita' ? 'üü¢ Receita' : 'üî¥ Despesa'}</td>
                        <td>${formatarData(item.data)}</td>
                        <td>${item.descricao}</td>
                        <td>${item.categoria}</td>
                        <td style="font-weight: 600;">${formatarMoeda(item.valor)}</td>
                        <td>
                            <button class="btn btn-danger" onclick="excluirItem('${item.tipo}', ${item.index})">üóëÔ∏è Excluir</button>
                        </td>
                    `;
                    tbodyRealizados.appendChild(tr);
                });
            }
        }

        // Inicializar Charts
        function inicializarCharts() {
            const ctxReceitas = document.getElementById('chartReceitas').getContext('2d');
            const ctxDespesas = document.getElementById('chartDespesas').getContext('2d');
            const ctxComparativo = document.getElementById('chartComparativo').getContext('2d');

            // Plugin para desenhar texto no centro do gr√°fico de rosca
            const centerTextPlugin = {
                id: 'centerText',
                beforeDraw: (chart) => {
                    const { ctx, data } = chart;
                    const total = data.datasets[0].data.reduce((a, b) => a + b, 0);
                    
                    if (total === 0) return;

                    // Encontrar o maior segmento
                    let maiorValor = 0;
                    let maiorLabel = '';
                    data.datasets[0].data.forEach((valor, index) => {
                        if (valor > maiorValor) {
                            maiorValor = valor;
                            maiorLabel = data.labels[index];
                        }
                    });

                    const percentual = ((maiorValor / total) * 100).toFixed(0);
                    const label = maiorLabel;

                    ctx.save();
                    const centerX = (chart.chartArea.left + chart.chartArea.right) / 2;
                    const centerY = (chart.chartArea.top + chart.chartArea.bottom) / 2;

                    // Desenhar o Percentual (23%)
                    ctx.font = 'bold 30px Ubuntu';
                    ctx.fillStyle = '#333';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(`${percentual}%`, centerX, centerY - 10);

                    // Desenhar o Label (mobile)
                    ctx.font = '16px Ubuntu';
                    ctx.fillStyle = 'gray';
                    ctx.fillText(label, centerX, centerY + 15);

                    ctx.restore();
                }
            };

            // Configura√ß√£o comum para gr√°ficos de rosca
            const doughnutOptions = {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '65%',
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.parsed || 0;
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = ((value / total) * 100).toFixed(0);
                                return `${label}: ${percentage}%`;
                            }
                        }
                    }
                }
            };

            chartReceitas = new Chart(ctxReceitas, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: coresReceitas,
                        borderColor: '#fff',
                        borderWidth: 0, spacing: 5
                    }]
                },
                options: doughnutOptions,
                plugins: [centerTextPlugin]
            });

            chartDespesas = new Chart(ctxDespesas, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: coresDespesas,
                        borderColor: '#fff',
                        borderWidth: 0, spacing: 5
                    }]
                },
                options: doughnutOptions,
                plugins: [centerTextPlugin]
            });

            chartComparativo = new Chart(ctxComparativo, {
                type: 'bar',
                data: {
                    labels: ['Receitas', 'Despesas'],
                    datasets: [{
                        label: 'Valores (R$)',
                        data: [0, 0],
                        backgroundColor: [
                            'rgba(253, 180, 92, 0.8)',
                            'rgba(74, 111, 165, 0.8)'
                        ],
                        borderColor: [
                            'rgba(253, 180, 92, 1)',
                            'rgba(74, 111, 165, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: 'white', font: { family: 'Ubuntu', size: 14 } }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { 
                                color: 'white',
                                font: { family: 'Ubuntu' },
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                }
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.2)' }
                        },
                        x: {
                            ticks: { 
                                color: 'white',
                                font: { family: 'Ubuntu', size: 14 }
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.2)' }
                        }
                    }
                }
            });
        }

        // Atualizar Charts
        function atualizarCharts() {
            // Apenas itens pendentes s√£o considerados para os dashboards
            const receitasPendentes = receitas.filter(r => !r.realizado);
            const despesasPendentes = despesas.filter(d => !d.realizado);

            // Receitas por categoria
            const receitasPorCategoria = {};
            receitasPendentes.forEach(item => {
                receitasPorCategoria[item.categoria] = (receitasPorCategoria[item.categoria] || 0) + item.valor;
            });

            chartReceitas.data.labels = Object.keys(receitasPorCategoria);
            chartReceitas.data.datasets[0].data = Object.values(receitasPorCategoria);
            chartReceitas.update();

            // Despesas por categoria
            const despesasPorCategoria = {};
            despesasPendentes.forEach(item => {
                despesasPorCategoria[item.categoria] = (despesasPorCategoria[item.categoria] || 0) + item.valor;
            });

            chartDespesas.data.labels = Object.keys(despesasPorCategoria);
            chartDespesas.data.datasets[0].data = Object.values(despesasPorCategoria);
            chartDespesas.update();

            // Comparativo
            const totalReceita = receitasPendentes.reduce((sum, item) => sum + item.valor, 0);
            const totalDespesa = despesasPendentes.reduce((sum, item) => sum + item.valor, 0);

            chartComparativo.data.datasets[0].data = [totalReceita, totalDespesa];
            chartComparativo.update();
        }

        // Salvar JSON
        function salvarJSON() {
            const dados = {
                receitas,
                despesas,
                skinAtual, // Salva o skin atual
                dataExportacao: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(dados, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `financeiro_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);

            alert('Dados salvos com sucesso!');
        }

        // Carregar JSON
        function carregarJSON(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const dados = JSON.parse(e.target.result);
                    receitas = dados.receitas || [];
                    despesas = dados.despesas || [];
                    
                    // Carrega o skin salvo
                    if (dados.skinAtual) {
                        const skinIndex = skins.findIndex(s => s.css === dados.skinAtual);
                        if (skinIndex !== -1) {
                            mudarSkin(dados.skinAtual, skinIndex);
                        }
                    }

                    atualizarInterface();
                    alert('Dados carregados com sucesso!');
                } catch (error) {
                    alert('Erro ao carregar arquivo. Verifique se o formato est√° correto.');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // Gerar Relat√≥rio PDF
        function gerarRelatorioPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // T√≠tulo
            doc.setFontSize(20);
            doc.setTextColor(74, 124, 158);
            doc.text('Relat√≥rio Financeiro', 105, 20, { align: 'center' });

            // Data
            doc.setFontSize(10);
            doc.setTextColor(100);
            doc.text(`Gerado em: ${formatarData(new Date().toISOString().split('T')[0])}`, 105, 28, { align: 'center' });

            // Resumo
            doc.setFontSize(14);
            doc.setTextColor(0);
            doc.text('Resumo Financeiro (Pendentes)', 20, 40);

            const totalReceita = receitas
                .filter(r => !r.realizado)
                .reduce((sum, item) => sum + item.valor, 0);
            const totalDespesa = despesas
                .filter(d => !d.realizado)
                .reduce((sum, item) => sum + item.valor, 0);
            const saldo = totalReceita - totalDespesa;

            doc.setFontSize(11);
            doc.text(`Receita Total: ${formatarMoeda(totalReceita)}`, 20, 50);
            doc.text(`Despesa Total: ${formatarMoeda(totalDespesa)}`, 20, 57);
            doc.setTextColor(saldo >= 0 ? 0 : 255, saldo >= 0 ? 128 : 0, 0);
            doc.text(`Saldo: ${formatarMoeda(saldo)}`, 20, 64);

            // Itens Pendentes
            doc.setTextColor(0);
            doc.setFontSize(14);
            doc.text('Itens Pendentes', 20, 78);

            let y = 86;
            doc.setFontSize(9);
            const itensPendentes = [
                ...receitas.map(item => ({...item, tipo: 'receita'})).filter(item => !item.realizado),
                ...despesas.map(item => ({...item, tipo: 'despesa'})).filter(item => !item.realizado)
            ].sort((a, b) => new Date(b.data) - new Date(a.data));

            itensPendentes.forEach((item) => {
                if (y > 270) {
                    doc.addPage();
                    y = 20;
                }
                const tipoStr = item.tipo === 'receita' ? 'Receita' : 'Despesa';
                doc.text(`${tipoStr} - ${formatarData(item.data)} - ${item.descricao} (${item.categoria}): ${formatarMoeda(item.valor)}`, 20, y);
                y += 6;
            });

            // Itens Realizados
            y += 8;
            if (y > 260) {
                doc.addPage();
                y = 20;
            }
            doc.setFontSize(14);
            doc.text('Itens Realizados', 20, y);
            y += 8;

            doc.setFontSize(9);
            const itensRealizados = [
                ...receitas.map(item => ({...item, tipo: 'receita'})).filter(item => item.realizado),
                ...despesas.map(item => ({...item, tipo: 'despesa'})).filter(item => item.realizado)
            ].sort((a, b) => new Date(b.data) - new Date(a.data));

            itensRealizados.forEach((item) => {
                if (y > 270) {
                    doc.addPage();
                    y = 20;
                }
                const tipoStr = item.tipo === 'receita' ? 'Receita' : 'Despesa';
                doc.text(`[REALIZADO] ${tipoStr} - ${formatarData(item.data)} - ${item.descricao} (${item.categoria}): ${formatarMoeda(item.valor)}`, 20, y);
                y += 6;
            });

            // Salvar
            doc.save(`relatorio_financeiro_${new Date().toISOString().split('T')[0]}.pdf`);
        }

        // Formatadores
        function formatarMoeda(valor) {
            return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }

        function formatarData(data) {
            return new Date(data + 'T00:00:00').toLocaleDateString('pt-BR');
        }
    </script>
</body>
</html>
